<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Manoj Nehra | Learning Hub</title>
    
    <!-- Assets -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root { 
            --primary: #6366f1; 
            --accent: #a855f7;
            --dark: #0f172a;
            --glass: rgba(255, 255, 255, 0.05); 
            --bg-gradient: linear-gradient(135deg, #020617 0%, #1e1b4b 100%);
        }

        body { 
            background: var(--bg-gradient); color: #f8fafc; 
            font-family: 'Poppins', sans-serif; min-height: 100vh; 
            padding-bottom: 100px; -webkit-tap-highlight-color: transparent;
        }

        /* --- Glassmorphism Cards --- */
        .glass-card { 
            background: var(--glass); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; 
            padding: 20px; position: relative; overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .glass-card:active { transform: scale(0.98); }
        .glass-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(99, 102, 241, 0.2); }

        .price-badge { 
            position: absolute; top: 15px; right: 15px; 
            background: rgba(99, 102, 241, 0.9); color: white; 
            padding: 4px 12px; border-radius: 12px; font-weight: 700; font-size: 0.85rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* --- 3D Buttons & Inputs --- */
        .btn-3d {
            background: linear-gradient(145deg, #6366f1, #4f46e5);
            border: none; color: white; width: 100%; padding: 12px;
            border-radius: 16px; font-weight: 700; box-shadow: 0 4px 0 #3730a3;
            transition: all 0.1s;
        }
        .btn-3d:active { transform: translateY(4px); box-shadow: 0 0 0 #3730a3; }

        .input-3d {
            background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 16px; padding: 12px; color: white; width: 100%;
            text-align: center; font-weight: 600; outline: none; margin-bottom: 10px;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
        }
        .input-3d:focus { border-color: var(--primary); }

        /* --- Profile 3D --- */
        .profile-wrap { perspective: 1000px; padding: 20px; }
        .profile-card {
            background: rgba(255,255,255,0.03); border-radius: 30px; padding: 30px 20px;
            border: 1px solid rgba(255,255,255,0.1); text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .menu-btn {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px;
            margin-bottom: 10px; display: flex; align-items: center; cursor: pointer;
            border: 1px solid rgba(255,255,255,0.05); transition: 0.2s;
        }
        .menu-btn:active { background: rgba(255,255,255,0.1); }
        .menu-btn i { width: 30px; color: var(--accent); font-size: 1.2rem; }

        /* --- Navigation Dock --- */
        .nav-dock { 
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); 
            width: 90%; max-width: 400px; background: rgba(15, 23, 42, 0.95); 
            border-radius: 25px; display: flex; justify-content: space-around; 
            padding: 12px; z-index: 1000; border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); backdrop-filter: blur(10px);
        }
        .nav-item { 
            text-align: center; color: rgba(255,255,255,0.5); font-size: 0.7rem; 
            cursor: pointer; transition: 0.3s; flex: 1;
        }
        .nav-item i { font-size: 1.4rem; display: block; margin-bottom: 2px; }
        .nav-item.active { color: var(--primary); transform: translateY(-5px); }

        /* --- Overlays & Modals --- */
        .overlay { display: none; position: fixed; inset: 0; background: #020617; z-index: 2000; overflow-y: auto; padding: 20px; animation: fadeInUp 0.3s; }
        .page { display: none; animation: fadeIn 0.4s; }
        .page.active { display: block; }

        /* Login Screen */
        #auth-screen { position: fixed; inset: 0; z-index: 5000; background: #020617; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body oncontextmenu="return false;">

    <!-- 1. LOGIN SCREEN -->
    <div id="auth-screen">
        <div class="glass-card text-center" style="width: 85%; max-width: 350px;">
            <img src="./manoj.jpg.jpg" class="rounded-circle border border-3 border-primary shadow mb-3" width="90" height="90" onerror="this.src='https://via.placeholder.com/90'">
            <h3 class="fw-bold mb-1">Manoj Nehra</h3>
            <p class="small text-muted mb-4">Official Preparation App</p>
            <button onclick="login()" class="btn btn-light w-100 rounded-pill py-2 fw-bold mb-3">
                <i class="fab fa-google me-2"></i> Sign In
            </button>
            <div class="small text-white-50" onclick="openPageOverlay('privacy')">Read <u class="text-primary">Privacy Policy</u></div>
        </div>
    </div>

    <!-- 2. MAIN APPLICATION -->
    <div id="main-app" style="display:none;">
        
        <!-- Header -->
        <div class="container pt-3 pb-2 sticky-top" style="background: rgba(2,6,23,0.95); z-index: 900;">
            <div class="d-flex align-items-center">
                <img id="head-img" src="" class="rounded-circle border border-secondary" width="45" height="45">
                <div class="ms-3">
                    <h6 class="mb-0 fw-bold" id="user-name">Loading...</h6>
                    <small class="text-success fw-bold">Online Student</small>
                </div>
            </div>
        </div>

        <div class="container mt-2">
            
            <!-- A. HOME (NOTES) -->
            <div id="homePage" class="page active">
                <h5 class="fw-bold mb-3 ps-1 border-start border-4 border-primary ps-2">Latest PDF Notes</h5>
                <div id="notes-container" class="row g-3 pb-5">
                    <!-- Notes loaded from Firebase -->
                    <div class="text-center text-muted mt-5"><i class="fas fa-spinner fa-spin"></i> Syncing...</div>
                </div>
            </div>

            <!-- B. TESTS -->
            <div id="testsPage" class="page">
                <h5 class="fw-bold mb-3 ps-1 border-start border-4 border-info ps-2">Online Test Series</h5>
                <div id="tests-container" class="row g-3 pb-5">
                    <!-- Tests loaded from Firebase -->
                </div>
            </div>

            <!-- C. PROFILE -->
            <div id="profilePage" class="page">
                <div class="profile-wrap">
                    <div class="profile-card">
                        <img id="prof-img" src="" class="rounded-circle mb-3 border border-4 border-primary shadow" width="100">
                        <input id="p-name" class="input-3d" placeholder="Your Name">
                        <input id="p-phone" class="input-3d" type="tel" placeholder="Phone Number">
                        <input id="p-state" class="input-3d" placeholder="State (e.g. Rajasthan)">
                        
                        <button onclick="saveProfile()" class="btn-3d mt-2">Save Profile</button>

                        <div class="mt-4 text-start">
                            <div class="menu-btn" onclick="openPageOverlay('about')"><i class="fas fa-info-circle me-3"></i> About App</div>
                            <div class="menu-btn" onclick="openPageOverlay('contact')"><i class="fas fa-headset me-3"></i> Help & Support</div>
                            <div class="menu-btn" onclick="openPageOverlay('privacy')"><i class="fas fa-shield-alt me-3"></i> Privacy Policy</div>
                        </div>

                        <button onclick="logout()" class="btn btn-outline-danger w-100 rounded-pill mt-4 fw-bold">Log Out</button>
                    </div>
                </div>
            </div>

        </div>

        <!-- D. NAVIGATION -->
        <nav class="nav-dock">
            <div class="nav-item active" onclick="nav('homePage', this)"><i class="fas fa-book"></i>Notes</div>
            <div class="nav-item" onclick="nav('testsPage', this)"><i class="fas fa-laptop-code"></i>Tests</div>
            <div class="nav-item" onclick="nav('profilePage', this)"><i class="fas fa-user-astronaut"></i>Profile</div>
        </nav>

    </div>

    <!-- 3. OVERLAYS (Info Pages & Exam UI) -->
    
    <!-- Info Page Overlay -->
    <div id="infoOverlay" class="overlay">
        <div class="d-flex justify-content-between align-items-center mb-4 sticky-top bg-dark py-2">
            <h4 id="infoTitle" class="fw-bold text-primary m-0">TITLE</h4>
            <button onclick="document.getElementById('infoOverlay').style.display='none'" class="btn btn-sm btn-secondary rounded-pill px-3">Close</button>
        </div>
        <div id="infoBody" class="text-white-50 lh-lg">Loading...</div>
    </div>

    <!-- Exam Start Overlay (Simple Placeholder) -->
    <div id="examStartOverlay" class="overlay">
        <div class="glass-card mt-5 text-center">
            <i class="fas fa-clipboard-check text-warning mb-3" style="font-size:3rem;"></i>
            <h3 class="fw-bold" id="examStartTitle">Exam Name</h3>
            <p class="text-white-50">Duration: <span id="examStartDur"></span> Mins | Marks: <span id="examStartMarks"></span></p>
            <div class="alert alert-info small text-start bg-transparent border-info text-info">
                Instructions: <br>1. Do not switch tabs.<br>2. Stable internet required.
            </div>
            <button class="btn-3d" onclick="Swal.fire('Exam Started', 'Questions will appear here (Engine Logic)', 'success')">BEGIN TEST NOW</button>
            <button onclick="document.getElementById('examStartOverlay').style.display='none'" class="btn btn-link text-white text-decoration-none mt-3">Cancel</button>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, get, update, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // FIREBASE CONFIG
        const firebaseConfig = { 
            apiKey: "AIzaSyAhg7hKJ123JRAfio7fymK543XpuNonMHo", 
            databaseURL: "https://showpdf-ffa34-default-rtdb.firebaseio.com", 
            projectId: "showpdf-ffa34",
            authDomain: "showpdf-ffa34.firebaseapp.com"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        const provider = new GoogleAuthProvider();

        // 1. AUTH LOGIC
        window.login = () => {
            signInWithPopup(auth, provider).catch(e => Swal.fire('Error', e.message, 'error'));
        };

        window.logout = () => signOut(auth).then(() => location.reload());

        onAuthStateChanged(auth, (user) => {
            if(user) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                
                // Set User Info
                document.getElementById('user-name').innerText = user.displayName;
                document.getElementById('head-img').src = user.photoURL;
                document.getElementById('prof-img').src = user.photoURL;
                
                // Load Profile Data
                get(ref(db, `users/${user.uid}/profile`)).then(snap => {
                    if(snap.exists()) {
                        const d = snap.val();
                        document.getElementById('p-name').value = d.name || user.displayName;
                        document.getElementById('p-phone').value = d.phone || "";
                        document.getElementById('p-state').value = d.state || "";
                    }
                });

                // Start Listeners
                loadContent();
            } else {
                document.getElementById('auth-screen').style.display = 'flex';
            }
        });

        // 2. PROFILE SAVE
        window.saveProfile = () => {
            const user = auth.currentUser;
            if(!user) return;
            update(ref(db, `users/${user.uid}/profile`), {
                name: document.getElementById('p-name').value,
                phone: document.getElementById('p-phone').value,
                state: document.getElementById('p-state').value
            }).then(() => Swal.fire('Saved', 'Profile Updated', 'success'));
        };

        // 3. CONTENT LOADING (Realtime)
        function loadContent() {
            // A. Notes
            onValue(ref(db, 'notes'), (snapshot) => {
                const box = document.getElementById('notes-container');
                box.innerHTML = '';
                if(!snapshot.exists()) { box.innerHTML = '<div class="text-center w-100 opacity-50">No notes yet.</div>'; return; }
                
                snapshot.forEach(child => {
                    const n = child.val();
                    box.innerHTML += `
                        <div class="col-12 col-md-6">
                            <div class="glass-card">
                                <span class="price-badge">₹${n.price}</span>
                                <h5 class="fw-bold pe-4 text-truncate">${n.title}</h5>
                                <p class="small opacity-75 mb-3" style="min-height:40px">${n.desc || 'PDF Study Material'}</p>
                                <button onclick="window.open('${n.link}', '_blank')" class="btn-3d">
                                    <i class="fas fa-file-pdf me-2"></i> Open PDF
                                </button>
                            </div>
                        </div>`;
                });
            });

            // B. Tests
            onValue(ref(db, 'testSeries'), (snapshot) => {
                const box = document.getElementById('tests-container');
                box.innerHTML = '';
                if(!snapshot.exists()) { box.innerHTML = '<div class="text-center w-100 opacity-50">No tests yet.</div>'; return; }
                
                snapshot.forEach(child => {
                    const t = child.val();
                    // We store the JSON questions in t.questions
                    // For now, we just pass basic info to the Start function
                    box.innerHTML += `
                        <div class="col-12 col-md-6">
                            <div class="glass-card" style="border-left: 4px solid var(--accent)">
                                <span class="price-badge" style="background:var(--accent)">₹${t.price}</span>
                                <h5 class="fw-bold pe-4">${t.title}</h5>
                                <div class="d-flex gap-3 small opacity-75 mb-3">
                                    <span><i class="far fa-clock"></i> ${t.duration}m</span>
                                    <span><i class="fas fa-star"></i> ${t.totalMarks} Marks</span>
                                </div>
                                <button onclick="openExamModal('${t.title}', '${t.duration}', '${t.totalMarks}')" class="btn-3d" style="filter: hue-rotate(45deg);">
                                    <i class="fas fa-play me-2"></i> Attempt Test
                                </button>
                            </div>
                        </div>`;
                });
            });
        }

        // 4. UI FUNCTIONS
        window.nav = (pageId, el) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
        };

        window.openPageOverlay = (type) => {
            document.getElementById('infoOverlay').style.display = 'block';
            document.getElementById('infoTitle').innerText = type.toUpperCase();
            document.getElementById('infoBody').innerHTML = '<div class="text-center mt-5"><i class="fas fa-spinner fa-spin"></i></div>';
            
            get(ref(db, `pages/${type}`)).then(snap => {
                document.getElementById('infoBody').innerHTML = snap.val() || "No content available.";
            });
        };

        window.openExamModal = (title, dur, marks) => {
            document.getElementById('examStartOverlay').style.display = 'block';
            document.getElementById('examStartTitle').innerText = title;
            document.getElementById('examStartDur').innerText = dur;
            document.getElementById('examStartMarks').innerText = marks;
        }

    </script>
</body>
</html>
