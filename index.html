<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | ExamPro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        body { background: #0f172a; color: white; font-family: 'Inter', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeInUp 0.3s ease; }
        .nav-btn.active { background: #4f46e5; color: white; border-color: #6366f1; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="flex flex-col md:flex-row min-h-screen">
    <aside class="w-full md:w-72 bg-slate-900 border-r border-white/5 flex flex-col p-6 shrink-0 z-50">
        <h2 class="text-2xl font-black text-indigo-500 italic mb-10">ADMIN<span class="text-white">PRO</span></h2>
        <nav class="flex flex-row md:flex-col gap-2 overflow-x-auto">
            <button onclick="switchTab('tab-cat', this)" class="nav-btn active p-4 rounded-2xl text-left flex items-center gap-3 border border-transparent whitespace-nowrap"><i class="fa-solid fa-folder-tree"></i> Categories</button>
            <button onclick="switchTab('tab-add', this)" class="nav-btn p-4 rounded-2xl text-left flex items-center gap-3 text-slate-400 whitespace-nowrap"><i class="fa-solid fa-plus-circle"></i> Add/Edit Series</button>
            <button onclick="switchTab('tab-manage', this)" class="nav-btn p-4 rounded-2xl text-left flex items-center gap-3 text-slate-400 whitespace-nowrap"><i class="fa-solid fa-layer-group"></i> Live Series</button>
        </nav>
    </aside>

    <main class="flex-1 p-6 md:p-12 overflow-y-auto">
        <div id="tab-cat" class="tab-content active">
            <h1 class="text-3xl font-bold mb-8">Categories</h1>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                <div class="bg-slate-800 p-8 rounded-[2rem] border border-white/5 h-fit">
                    <input id="cat-input" type="text" placeholder="SSC, Police..." class="w-full bg-slate-900 p-4 rounded-2xl border-none mb-4 outline-none ring-1 ring-white/10 focus:ring-2 ring-indigo-500">
                    <button onclick="addCategory()" class="w-full bg-indigo-600 py-4 rounded-2xl font-bold">Add Category</button>
                </div>
                <div id="cat-display-list" class="space-y-3"></div>
            </div>
        </div>

        <div id="tab-add" class="tab-content">
            <h1 id="form-heading" class="text-3xl font-bold mb-8">Publish New Series</h1>
            <div class="bg-slate-800 p-8 rounded-[2.5rem] shadow-2xl border border-white/5 max-w-4xl">
                <input type="hidden" id="edit-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <input id="s-title" type="text" placeholder="Series Title" class="w-full bg-slate-900 p-4 rounded-2xl outline-none ring-1 ring-white/5">
                    <input id="s-price" type="number" placeholder="Price (INR)" class="w-full bg-slate-900 p-4 rounded-2xl outline-none ring-1 ring-white/5">
                    
                    <!-- NEW MARKING SYSTEM INPUTS -->
                    <input id="s-pos" type="number" step="0.1" placeholder="Correct Answer (+ Marks)" class="w-full bg-slate-900 p-4 rounded-2xl outline-none ring-1 ring-indigo-500">
                    <input id="s-neg" type="number" step="0.1" placeholder="Wrong Answer (- Marks)" class="w-full bg-slate-900 p-4 rounded-2xl outline-none ring-1 ring-red-500">
                    
                    <select id="s-cat-select" class="w-full bg-slate-900 p-4 rounded-2xl ring-1 ring-white/5"></select>
                    <div onclick="document.getElementById('img-file').click()" class="bg-slate-900 p-4 rounded-2xl text-center border-2 border-dashed border-white/10 cursor-pointer">
                        <input type="file" id="img-file" hidden accept="image/*" onchange="previewThumbnail(event)">
                        <span id="img-placeholder" class="text-slate-500">Upload Thumbnail Image</span>
                        <img id="img-preview-box" class="hidden w-full h-32 object-cover rounded-xl">
                    </div>
                </div>
                <textarea id="s-json" rows="6" placeholder='Questions JSON Array' class="w-full bg-slate-900 p-5 rounded-3xl outline-none font-mono text-xs mb-6"></textarea>
                <button onclick="publishSeries()" class="w-full bg-green-600 py-5 rounded-[2rem] font-black uppercase">Publish Live</button>
            </div>
        </div>

        <div id="tab-manage" class="tab-content">
            <h1 class="text-3xl font-bold mb-8">Manage Live Series</h1>
            <div id="live-series-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>
    </main>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyAhg7hKJ123JRAfio7fymK543XpuNonMHo", databaseURL: "https://showpdf-ffa34-default-rtdb.firebaseio.com", projectId: "showpdf-ffa34" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let base64Image = "";

        function switchTab(tabId, btn) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            btn.classList.add('active');
            if(tabId !== 'tab-add') resetForm();
        }

        function addCategory() {
            const val = document.getElementById('cat-input').value.trim();
            if(val) db.ref('categories').push(val).then(() => document.getElementById('cat-input').value = "");
        }

        db.ref('categories').on('value', snap => {
            const list = document.getElementById('cat-display-list');
            const select = document.getElementById('s-cat-select');
            list.innerHTML = ""; select.innerHTML = "";
            snap.forEach(child => {
                list.innerHTML += `<div class="bg-slate-800 p-4 rounded-2xl flex justify-between"><span>${child.val()}</span><button onclick="db.ref('categories/${child.key}').remove()" class="text-red-500">Del</button></div>`;
                select.innerHTML += `<option value="${child.val()}">${child.val()}</option>`;
            });
        });

        function previewThumbnail(e) {
            const reader = new FileReader();
            reader.onload = () => { base64Image = reader.result; document.getElementById('img-preview-box').src = base64Image; document.getElementById('img-preview-box').classList.remove('hidden'); document.getElementById('img-placeholder').classList.add('hidden'); };
            reader.readAsDataURL(e.target.files[0]);
        }

        function publishSeries() {
            const id = document.getElementById('edit-id').value;
            const data = {
                title: document.getElementById('s-title').value,
                price: document.getElementById('s-price').value,
                posMarks: document.getElementById('s-pos').value || 1,
                negMarks: document.getElementById('s-neg').value || 0,
                cat: document.getElementById('s-cat-select').value,
                questions: document.getElementById('s-json').value,
                image: base64Image
            };
            const ref = id ? db.ref('testSeries/' + id) : db.ref('testSeries').push();
            ref.set(data).then(() => { Swal.fire('Success', 'Series Published', 'success'); switchTab('tab-manage', document.querySelectorAll('.nav-btn')[2]); });
        }

        db.ref('testSeries').on('value', snap => {
            const grid = document.getElementById('live-series-grid'); grid.innerHTML = "";
            snap.forEach(child => {
                const s = child.val();
                grid.innerHTML += `<div class="bg-slate-800 p-5 rounded-[2rem] border border-white/5"><img src="${s.image}" class="w-full h-32 object-cover rounded-2xl mb-4"><h4>${s.title}</h4><div class="flex gap-2 mt-4"><button onclick="editSeries('${child.key}')" class="flex-1 bg-indigo-600 py-2 rounded-xl">Edit</button><button onclick="db.ref('testSeries/${child.key}').remove()" class="bg-red-500 px-4 rounded-xl">Del</button></div></div>`;
            });
        });

        function editSeries(id) {
            db.ref('testSeries/' + id).once('value', snap => {
                const s = snap.val();
                document.getElementById('edit-id').value = id;
                document.getElementById('s-title').value = s.title;
                document.getElementById('s-price').value = s.price;
                document.getElementById('s-pos').value = s.posMarks;
                document.getElementById('s-neg').value = s.negMarks;
                document.getElementById('s-json').value = s.questions;
                base64Image = s.image;
                document.getElementById('img-preview-box').src = s.image;
                document.getElementById('img-preview-box').classList.remove('hidden');
                document.getElementById('img-placeholder').classList.add('hidden');
                switchTab('tab-add', document.querySelectorAll('.nav-btn')[1]);
            });
        }

        function resetForm() { document.getElementById('edit-id').value = ""; document.getElementById('img-preview-box').classList.add('hidden'); document.getElementById('img-placeholder').classList.remove('hidden'); base64Image = ""; }
    </script>
</body>
</html>
