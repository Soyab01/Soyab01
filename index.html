<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Manoj Nehra | Official Hub</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <style>
        :root { --primary: #6366f1; --glass: rgba(255, 255, 255, 0.08); --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%); }
        body { background: var(--bg-gradient); color: #f8fafc; font-family: 'Poppins', sans-serif; min-height: 100vh; overflow-x: hidden; padding-bottom: 120px; user-select: none; }
        .glass-card { background: var(--glass); backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.15); border-radius: 25px; padding: 22px; margin-bottom: 18px; box-shadow: 0 15px 35px rgba(0,0,0,0.4); }
        .nav-dock { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 95%; max-width: 500px; background: rgba(15, 23, 42, 0.95); border-radius: 30px; display: flex; justify-content: space-around; padding: 10px 5px; z-index: 8000; border: 1px solid rgba(255,255,255,0.15); }
        .nav-link-3d { color: rgba(255,255,255,0.4); text-decoration: none; text-align: center; flex: 1; font-size: 0.7rem; cursor: pointer; }
        .nav-link-3d.active { color: var(--primary); transform: translateY(-5px); text-shadow: 0 0 10px var(--primary); }
        .nav-link-3d i { font-size: 1.2rem; display: block; margin-bottom: 2px; }
        .page { display: none; } .page.active { display: block; }
        .test-card-img { width: 100%; height: 140px; object-fit: cover; border-radius: 15px; margin-bottom: 12px; }
        #exam-overlay, #testListOverlay, #result-overlay, #info-page-overlay { display: none; position: fixed; inset: 0; background: #020617; z-index: 9999; flex-direction: column; overflow-y:auto; }
        .opt-btn { text-align: left; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; width: 100%; color: white; margin-bottom: 10px; }
        .opt-btn.selected { background: var(--primary); border-color: white; }
        #reader-overlay { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; }
        iframe { width: 100%; height: 92vh; border: none; }
        .leaderboard-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 0.9rem; }
        .rank-badge { width: 25px; height: 25px; background: var(--primary); border-radius: 50%; display: inline-flex; justify-content: center; align-items: center; font-size: 0.7rem; margin-right: 10px; }
    </style>
</head>
<body oncontextmenu="return false;">

    <!-- AUTH SCREEN -->
    <div id="auth-screen" style="position:fixed; inset:0; background:#020617; z-index:9000; display:flex; align-items:center; justify-content:center; flex-direction:column;">
        <div class="glass-card text-center" style="width: 90%; max-width: 380px;">
            <img src="./manoj.jpg.jpg" style="width: 90px; height:90px; border-radius: 50%; border: 3px solid var(--primary); margin-bottom: 15px; object-fit:cover;">
            <h3 class="fw-800">MANOJ NEHRA</h3>
            <button onclick="login()" class="btn btn-light w-100 rounded-pill py-2 mt-3 mb-3">Sign in with Google</button>
            <p class="small opacity-50" onclick="showInfoPage('privacy')">By logging in, you agree to our <u class="text-primary">Privacy Policy</u></p>
        </div>
    </div>

    <!-- INFO PAGES OVERLAY (Privacy, About, Contact) -->
    <div id="info-page-overlay" class="p-4">
        <button onclick="closeInfoPage()" class="btn btn-sm btn-outline-light mb-4"><i class="fa fa-arrow-left"></i> Back</button>
        <div id="info-content" class="container text-white-50" style="font-size: 0.9rem; line-height: 1.8;"></div>
    </div>

    <!-- MAIN APP -->
    <div id="main-app" style="display:none;">
        <header class="container pt-4">
            <div class="d-flex align-items-center gap-2">
                <img src="./manoj.jpg.jpg" style="width:40px; height:40px; border-radius: 50%;">
                <div class="d-flex flex-column">
                    <h6 class="fw-bold mb-0">MANOJ NEHRA</h6>
                    <div id="welcome-user" class="small text-info fw-bold" style="font-size: 0.75rem;">Welcome, User</div>
                </div>
            </div>
        </header>

        <div class="container mt-2">
            <div id="homePage" class="page active">
                <div class="py-3"><h3 class="fw-800">Premium Notes</h3></div>
                <div id="notesGrid" class="row g-3"></div>
            </div>
            <div id="testSeriesPage" class="page">
                <div class="py-3 text-center"><h3 class="fw-800">Online Test Series</h3></div>
                <div id="testSeriesGrid" class="row g-3"></div>
            </div>
            <div id="purchasePage" class="page pt-3">
                <h3 class="text-center mb-4">मेरी लाइब्रेरी</h3>
                <div id="myNotesGrid" class="mb-4"></div>
                <div id="myTestsGrid"></div>
            </div>
            <div id="profilePage" class="page">
                <div class="glass-card text-center mt-4">
                    <img id="u-img" src="" class="rounded-circle mb-3 shadow" style="width: 80px; height:80px; border: 3px solid var(--primary); object-fit:cover;">
                    <div class="mb-4">
                        <label class="small opacity-50 d-block">Full Name</label>
                        <input id="prof-name" type="text" class="form-control bg-transparent text-white text-center border-0 fw-bold">
                        <label class="small opacity-50 d-block mt-2">Mobile Number</label>
                        <input id="prof-phone" type="number" class="form-control bg-transparent text-white text-center border-0 fw-bold" placeholder="Add Number">
                        <label class="small opacity-50 d-block mt-2">State</label>
                        <input id="prof-state" type="text" class="form-control bg-transparent text-white text-center border-0 fw-bold" placeholder="Enter State">
                        <button onclick="updateProfile()" class="btn btn-primary btn-sm rounded-pill px-4 mt-3">Save Changes</button>
                    </div>
                    <div class="text-start mt-4 border-top pt-3">
                        <button onclick="showInfoPage('about')" class="btn text-white w-100 text-start py-2 border-bottom border-white/5"><i class="fa fa-info-circle me-3"></i> About Us</button>
                        <button onclick="showInfoPage('contact')" class="btn text-white w-100 text-start py-2 border-bottom border-white/5"><i class="fa fa-phone me-3"></i> Contact Us</button>
                        <button onclick="showInfoPage('privacy')" class="btn text-white w-100 text-start py-2 border-bottom border-white/5"><i class="fa fa-lock me-3"></i> Privacy Policy</button>
                    </div>
                    <button class="btn btn-danger w-100 py-2 mt-4 rounded-pill" onclick="logout()">Logout Account</button>
                </div>
            </div>
        </div>

        <nav class="nav-dock">
            <div class="nav-link-3d active" onclick="showPage('homePage', this)"><i class="fas fa-home"></i>Home</div>
            <div class="nav-link-3d" onclick="showPage('testSeriesPage', this)"><i class="fas fa-edit"></i>Tests</div>
            <div class="nav-link-3d" onclick="showPage('purchasePage', this)"><i class="fas fa-bookmark"></i>Library</div>
            <div class="nav-link-3d" onclick="showPage('profilePage', this)"><i class="fas fa-user"></i>Profile</div>
        </nav>
    </div>

    <!-- Result & Leaderboard Overlay -->
    <div id="result-overlay" class="p-4">
        <button onclick="closeReview()" class="btn btn-sm btn-outline-light mb-4"><i class="fa fa-arrow-left"></i> Home</button>
        <div class="glass-card text-center mb-4">
            <h3 class="fw-800">Your Score</h3>
            <h1 id="final-score-val" class="text-primary fw-bold">0.0</h1>
            <p id="stats-summary" class="small opacity-75"></p>
            <button onclick="showReviewItems()" class="btn btn-outline-primary btn-sm rounded-pill w-100 mt-2">Test Preview</button>
        </div>
        <div class="glass-card">
            <h6 class="fw-bold mb-3"><i class="fa fa-trophy text-warning me-2"></i> Top 15 Rankings</h6>
            <div id="leaderboard-list"></div>
        </div>
        <div id="detailed-review" style="display:none;" class="mt-4"></div>
    </div>

    <!-- Original Overlays (Unchanged) -->
    <div id="testListOverlay" class="p-4">...</div>
    <div id="exam-overlay">...</div>
    <div id="reader-overlay">...</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, get, update, onValue, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Firebase config
        const firebaseConfig = { apiKey: "AIzaSyAhg7hKJ123JRAfio7fymK543XpuNonMHo", databaseURL: "https://showpdf-ffa34-default-rtdb.firebaseio.com", projectId: "showpdf-ffa34" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        const provider = new GoogleAuthProvider();

        window.login = () => signInWithPopup(auth, provider);
        window.logout = () => signOut(auth).then(() => location.reload());

        let userData = null;
        let currentExamQs = [], userAnswers = [], qIdx = 0, examTimer, curPos = 1, curRatio = 3, activeTestId = "";

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                userData = user;
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                document.getElementById('welcome-user').innerText = "Welcome, " + user.displayName;
                
                // Load Profile Data
                const pSnap = await get(ref(db, `users/${user.uid}/profile`));
                const pData = pSnap.exists() ? pSnap.val() : {};
                document.getElementById('u-img').src = user.photoURL;
                document.getElementById('prof-name').value = pData.name || user.displayName;
                document.getElementById('prof-phone').value = pData.phone || "";
                document.getElementById('prof-state').value = pData.state || "";

                loadNotes(); loadTestSeries();
            }
        });

        window.updateProfile = async () => {
            const data = {
                name: document.getElementById('prof-name').value,
                phone: document.getElementById('prof-phone').value,
                state: document.getElementById('prof-state').value
            };
            await update(ref(db, `users/${userData.uid}/profile`), data);
            Swal.fire('Success', 'Profile Updated', 'success');
        };

        // --- NEW RESULT & LEADERBOARD LOGIC ---
        window.finishExam = async () => {
            clearInterval(examTimer);
            document.getElementById('exam-overlay').style.display = 'none';
            
            let correct = 0, wrong = 0;
            currentExamQs.forEach((q, i) => { 
                if(userAnswers[i] === (q.ans || q.answer)) correct++; 
                else if(userAnswers[i] !== null) wrong++; 
            });
            
            let totalScore = (correct * curPos) - (wrong * (curPos / curRatio));
            
            // Save Score for Leaderboard
            const scoreData = {
                score: totalScore,
                userName: userData.displayName,
                photo: userData.photoURL,
                timestamp: Date.now()
            };
            await set(ref(db, `leaderboards/${activeTestId}/${userData.uid}`), scoreData);

            // Display Result
            document.getElementById('final-score-val').innerText = totalScore.toFixed(2);
            document.getElementById('stats-summary').innerText = `Correct: ${correct} | Wrong: ${wrong}`;
            document.getElementById('result-overlay').style.display = 'block';
            loadLeaderboard(activeTestId);
        };

        function loadLeaderboard(testId) {
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = "Loading rankings...";
            const dbRef = query(ref(db, `leaderboards/${testId}`), orderByChild('score'), limitToLast(15));
            onValue(dbRef, (snap) => {
                list.innerHTML = "";
                let students = [];
                snap.forEach(child => students.push(child.val()));
                students.reverse().forEach((s, i) => {
                    list.innerHTML += `
                        <div class="leaderboard-item">
                            <span><div class="rank-badge">${i+1}</div> ${s.userName}</span>
                            <span class="fw-bold text-primary">${s.score.toFixed(1)}</span>
                        </div>`;
                });
            });
        }

        // --- INFO PAGES CONTENT ---
        window.showInfoPage = (type) => {
            const overlay = document.getElementById('info-page-overlay');
            const content = document.getElementById('info-content');
            overlay.style.display = 'flex';
            
            const dummyLongText = "...(1500 Words Detailed Data Related to " + type.toUpperCase() + " Policies for Play Console)...";
            
            if(type === 'privacy') {
                content.innerHTML = `<h1>Privacy Policy</h1><p>Welcome to Manoj Nehra Official Hub. We respect your privacy. This policy describes how we collect and use data...</p>${dummyLongText}`;
            } else if(type === 'about') {
                content.innerHTML = `<h1>About Us</h1><p>Manoj Nehra is a premier platform for Rajasthan Exam preparations...</p>${dummyLongText}`;
            } else {
                content.innerHTML = `<h1>Contact Us</h1><p>Email: help@manojnehra.com <br> Support Hours: 10AM - 6PM</p>${dummyLongText}`;
            }
        };

        window.closeInfoPage = () => document.getElementById('info-page-overlay').style.display = 'none';

        // (Previous UI Helpers, Notes, Test Loading, Razorpay Functions Remain Exactly As Before)
    </script>
</body>
</html>
