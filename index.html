<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Manoj Nehra | Official Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        :root { --primary: #6366f1; --glass: rgba(255, 255, 255, 0.08); --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%); }
        body { background: var(--bg-gradient); color: #f8fafc; font-family: 'Poppins', sans-serif; min-height: 100vh; padding-bottom: 120px; user-select: none; overflow-x: hidden; }
        .glass-card { background: var(--glass); backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.15); border-radius: 25px; padding: 22px; margin-bottom: 18px; box-shadow: 0 15px 35px rgba(0,0,0,0.4); }
        .nav-dock { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 95%; max-width: 500px; background: rgba(15, 23, 42, 0.95); border-radius: 30px; display: flex; justify-content: space-around; padding: 10px 5px; z-index: 8000; border: 1px solid rgba(255,255,255,0.15); }
        .nav-link-3d { color: rgba(255,255,255,0.4); text-decoration: none; text-align: center; flex: 1; font-size: 0.7rem; cursor: pointer; }
        .nav-link-3d.active { color: var(--primary); text-shadow: 0 0 10px var(--primary); }
        .nav-link-3d i { font-size: 1.2rem; display: block; }
        .btn-premium { background: linear-gradient(135deg, var(--primary), #8b5cf6); border: none; color: white; padding: 8px 18px; border-radius: 12px; font-weight: 700; font-size: 0.8rem; }
        .page { display: none; } .page.active { display: block; }
        .test-card-img { width: 100%; height: 120px; object-fit: cover; border-radius: 15px; margin-bottom: 10px; }
        #exam-overlay { display: none; position: fixed; inset: 0; background: #020617; z-index: 9999; flex-direction: column; }
        .opt-btn { text-align: left; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; width: 100%; color: white; margin-bottom: 10px; }
        .opt-btn.selected { background: var(--primary); border-color: white; }
        #auth-screen { position: fixed; inset: 0; background: #020617; z-index: 9000; display: flex; align-items: center; justify-content: center; flex-direction: column; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="auth-screen">
        <div class="glass-card text-center" style="width: 90%; max-width: 380px;">
            <img src="./manoj.jpg.jpg" style="width: 80px; border-radius: 50%; border: 2px solid var(--primary); margin-bottom: 15px;">
            <h3 class="fw-800">MANOJ NEHRA</h3>
            <p class="small opacity-75 mb-4">Official Preparation Hub</p>
            <button onclick="login()" class="btn btn-light w-100 rounded-pill py-2">Sign in with Google</button>
        </div>
    </div>

    <div id="main-app" style="display:none;">
        <header class="container pt-4">
            <div class="d-flex align-items-center gap-2">
                <img src="./manoj.jpg.jpg" style="width:40px; height:40px; border-radius: 50%;">
                <div class="d-flex flex-column">
                    <h6 class="fw-bold mb-0">MANOJ NEHRA</h6>
                    <div id="user-display-name" class="small text-info fw-bold" style="font-size: 0.7rem;">Student</div>
                </div>
            </div>
        </header>

        <div class="container mt-3">
            <div id="homePage" class="page active">
                <h3 class="fw-800 mb-3">Premium Notes</h3>
                <div id="notesGrid" class="row g-3"></div>
            </div>

            <div id="testSeriesPage" class="page">
                <h3 class="fw-800 text-center">Online Test Series</h3>
                <div id="testSeriesGrid" class="row g-3 mt-2"></div>
            </div>

            <div id="purchasePage" class="page">
                <h3 class="text-center mb-4">मेरी लाइब्रेरी</h3>
                <div id="myNotesGrid" class="mb-4"></div>
                <div id="myTestsGrid"></div>
            </div>
        </div>

        <nav class="nav-dock">
            <div class="nav-link-3d active" onclick="showPage('homePage', this)"><i class="fas fa-home"></i>Home</div>
            <div class="nav-link-3d" onclick="showPage('testSeriesPage', this)"><i class="fas fa-edit"></i>Tests</div>
            <div class="nav-link-3d" onclick="showPage('purchasePage', this)"><i class="fas fa-bookmark"></i>Library</div>
        </nav>
    </div>

    <!-- Exam UI -->
    <div id="exam-overlay">
        <header class="p-3 bg-dark d-flex justify-content-between">
            <span id="exam-timer" class="text-danger fw-bold fs-4">60:00</span>
            <button onclick="finishExam()" class="btn btn-success">SUBMIT</button>
        </header>
        <div class="flex-grow-1 container d-flex align-items-center justify-content-center">
            <div class="glass-card w-100" style="max-width: 600px;">
                <p id="q-num" class="text-primary fw-bold small mb-2"></p>
                <h5 id="q-text" class="mb-4"></h5>
                <div id="opt-box"></div>
                <div class="d-flex justify-content-between mt-4">
                    <button onclick="prevQ()" class="btn btn-outline-light">Prev</button>
                    <button onclick="nextQ()" class="btn btn-primary">Next</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { apiKey: "AIzaSyAhg7hKJ123JRAfio7fymK543XpuNonMHo", databaseURL: "https://showpdf-ffa34-default-rtdb.firebaseio.com", projectId: "showpdf-ffa34" };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);
        const provider = new GoogleAuthProvider();

        window.login = () => signInWithPopup(auth, provider);
        let currentExamQs = [], userAnswers = [], qIdx = 0, examTimer, curPos = 1, curNeg = 0;

        onAuthStateChanged(auth, user => {
            if (user) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                document.getElementById('user-display-name').innerText = user.displayName;
                loadNotes(); loadTestSeries();
            }
        });

        async function loadNotes() {
            const snap = await get(ref(db, `users/${auth.currentUser.uid}/purchases/notes`));
            const purchased = snap.exists() ? snap.val() : {};
            const notes = [{ id: "n1", title: "Raj Police Notes", price: 99 }];
            let html = '';
            notes.forEach(n => {
                const isPaid = purchased[n.id]?.paid;
                html += `<div class="col-12"><div class="glass-card d-flex justify-content-between align-items-center"><h6>${n.title}</h6><button class="btn-premium">${isPaid ? 'पढ़ें' : '₹'+n.price}</button></div></div>`;
            });
            document.getElementById('notesGrid').innerHTML = html;
        }

        function loadTestSeries() {
            onValue(ref(db, 'testSeries'), async snap => {
                const data = snap.val(); if(!data) return;
                const pSnap = await get(ref(db, `users/${auth.currentUser.uid}/purchases/tests`));
                const purchased = pSnap.exists() ? pSnap.val() : {};
                const grid = document.getElementById('testSeriesGrid'); grid.innerHTML = "";
                Object.keys(data).forEach(id => {
                    const s = data[id]; const isPaid = purchased[id]?.paid;
                    grid.innerHTML += `<div class="col-6"><div class="glass-card text-center p-2"><img src="${s.image}" class="test-card-img"><h6 class="small">${s.title}</h6><button onclick="startExam('${id}')" class="btn-premium w-100 mt-2">${isPaid ? 'START' : '₹'+s.price}</button></div></div>`;
                });
            });
        }

        window.startExam = async (id) => {
            const snap = await get(ref(db, `testSeries/${id}`)); const s = snap.val();
            curPos = parseFloat(s.posMarks) || 1; curNeg = parseFloat(s.negMarks) || 0;
            currentExamQs = JSON.parse(s.questions)[0]; userAnswers = new Array(currentExamQs.length).fill(null);
            qIdx = 0; document.getElementById('exam-overlay').style.display = 'flex';
            document.querySelector('.nav-dock').style.display = 'none';
            renderQuestion(); startTimer(3600);
        };

        function renderQuestion() {
            const q = currentExamQs[qIdx]; document.getElementById('q-num').innerText = `Q.${qIdx+1}/${currentExamQs.length}`;
            document.getElementById('q-text').innerText = q.q; const box = document.getElementById('opt-box'); box.innerHTML = "";
            q.options.forEach(o => box.innerHTML += `<button onclick="selectOpt('${o}')" class="opt-btn ${userAnswers[qIdx]===o?'selected':''}">${o}</button>`);
        }

        window.selectOpt = (o) => { userAnswers[qIdx] = o; renderQuestion(); };
        window.nextQ = () => { if(qIdx < currentExamQs.length-1) { qIdx++; renderQuestion(); } };
        window.prevQ = () => { if(qIdx > 0) { qIdx--; renderQuestion(); } };

        function startTimer(s) { clearInterval(examTimer); examTimer = setInterval(() => { s--; let m=Math.floor(s/60), sec=s%60; document.getElementById('exam-timer').innerText=`${m}:${sec<10?'0':''}${sec}`; if(s<=0) finishExam(); }, 1000); }

        window.finishExam = () => {
            clearInterval(examTimer); document.getElementById('exam-overlay').style.display = 'none';
            document.querySelector('.nav-dock').style.display = 'flex';
            let correct = 0, wrong = 0;
            currentExamQs.forEach((q, i) => { if(userAnswers[i] === (q.ans || q.answer)) correct++; else if(userAnswers[i] !== null) wrong++; });
            let score = (correct * curPos) - (wrong * curNeg);
            Swal.fire({
                title: 'Test Result',
                html: `<div class="text-start"><b>Score: ${score.toFixed(2)}</b><br>Correct: ${correct}<br>Wrong: ${wrong}</div>`,
                confirmButtonText: 'Review Answers'
            }).then(() => showReview());
        };

        function showReview() {
            let html = '<div style="max-height:400px; overflow-y:auto; text-align:left;">';
            currentExamQs.forEach((q, i) => {
                const isR = userAnswers[i] === (q.ans || q.answer);
                html += `<div class="mb-3 border-bottom pb-2"><b>Q.${i+1} ${q.q}</b><br><span class="${isR?'text-success':'text-danger'}">Your: ${userAnswers[i]||'None'}</span><br><span class="text-success">Right: ${q.ans||q.answer}</span></div>`;
            });
            Swal.fire({ title: 'Review', html: html + '</div>' });
        }

        window.showPage = (id, el) => { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(id).classList.add('active'); document.querySelectorAll('.nav-link-3d').forEach(n => n.classList.remove('active')); el.classList.add('active'); };
    </script>
</body>
</html>
