<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Manoj Nehra | Official Hub</title>
    
    <!-- CSS Assets -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <style>
        :root { 
            --primary: #6366f1; 
            --accent: #8b5cf6;
            --glass: rgba(255, 255, 255, 0.08); 
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
            --shadow-3d: 0 20px 50px rgba(0,0,0,0.5), inset 2px 2px 10px rgba(255,255,255,0.05);
        }

        body { 
            background: var(--bg-gradient); color: #f8fafc; 
            font-family: 'Poppins', sans-serif; min-height: 100vh; 
            overflow-x: hidden; padding-bottom: 120px; user-select: none; 
        }

        /* --- UI Components --- */
        .glass-card { 
            background: var(--glass); backdrop-filter: blur(25px); 
            border: 1px solid rgba(255,255,255,0.15); border-radius: 30px; 
            padding: 25px; box-shadow: var(--shadow-3d); 
        }

        /* --- 3D Profile UX --- */
        .profile-3d-wrap { perspective: 1000px; max-width: 450px; margin: auto; }
        .profile-inner {
            background: rgba(255, 255, 255, 0.03); border-radius: 40px; padding: 35px 20px;
            border: 1px solid rgba(255,255,255,0.1); box-shadow: 25px 25px 60px rgba(0,0,0,0.6);
        }
        .btn-3d-tile {
            background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(0,0,0,0.2));
            border: 1px solid rgba(255,255,255,0.08); border-radius: 20px;
            padding: 18px 25px; margin-bottom: 15px; display: flex; align-items: center;
            color: white; text-decoration: none; transition: 0.3s;
            box-shadow: 8px 8px 20px rgba(0,0,0,0.3);
        }
        .btn-3d-tile:active { transform: scale(0.95) translateZ(-10px); }
        .btn-3d-tile i { font-size: 1.4rem; margin-right: 15px; color: var(--primary); }

        .input-group-3d { background: rgba(0,0,0,0.3); border-radius: 15px; padding: 10px; margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.05); box-shadow: inset 3px 3px 10px rgba(0,0,0,0.4); }
        .input-group-3d input { background: transparent; border: none; color: white; width: 100%; text-align: center; font-weight: 600; outline: none; }

        /* --- Centered Login --- */
        #auth-screen { position: fixed; inset: 0; background: #020617; z-index: 9000; display: flex; align-items: center; justify-content: center; }
        .login-box { text-align: center; width: 90%; max-width: 400px; animation: zoomIn 0.5s; }
        .login-logo { width: 110px; height: 110px; border-radius: 50%; border: 4px solid var(--primary); margin-bottom: 25px; box-shadow: 0 0 30px var(--primary); }

        /* --- Navigation --- */
        .nav-dock { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 95%; max-width: 500px; background: rgba(15, 23, 42, 0.98); border-radius: 35px; display: flex; justify-content: space-around; padding: 12px 5px; z-index: 8000; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 25px 70px rgba(0,0,0,0.8); }
        .nav-link-3d { color: rgba(255,255,255,0.4); text-decoration: none; text-align: center; flex: 1; font-size: 0.75rem; cursor: pointer; transition: 0.4s; }
        .nav-link-3d.active { color: var(--primary); transform: translateY(-8px) scale(1.1); text-shadow: 0 0 15px var(--primary); }
        .nav-link-3d i { font-size: 1.3rem; display: block; margin-bottom: 3px; }

        /* --- Modals --- */
        #info-page-overlay { display: none; position: fixed; inset: 0; background: #010413; z-index: 9999; flex-direction: column; padding: 25px; overflow-y: auto; }
        .info-header { position: sticky; top: 0; background: #010413; padding: 10px 0; z-index: 10; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px; }
        .info-body { color: rgba(255,255,255,0.7); font-size: 0.95rem; line-height: 1.8; text-align: justify; }

        .page { display: none; } .page.active { display: block; animation: fadeInUp 0.5s; }
        #exam-overlay, #testListOverlay, #result-overlay { display: none; position: fixed; inset: 0; background: #020617; z-index: 9995; flex-direction: column; overflow-y:auto; }
    </style>
</head>
<body oncontextmenu="return false;">

    <!-- LOGIN SCREEN -->
    <div id="auth-screen">
        <div class="login-box glass-card">
            <img src="./manoj.jpg.jpg" class="login-logo" onerror="this.src='https://via.placeholder.com/110'">
            <h2 class="fw-800">MANOJ NEHRA</h2>
            <p class="small opacity-75 mb-4">Official Preparation Platform</p>
            <button onclick="login()" class="btn btn-light w-100 rounded-pill py-3 fw-bold shadow-lg mb-3">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" class="me-2">
                Sign in with Google
            </button>
            <p class="small opacity-50" onclick="showInfoPage('privacy')">By continuing, you accept our <u class="text-primary cursor-pointer">Privacy Policy</u></p>
        </div>
    </div>

    <!-- MAIN APP UI -->
    <div id="main-app" style="display:none;">
        <header class="container pt-4">
            <div class="d-flex align-items-center gap-3">
                <img src="./manoj.jpg.jpg" onerror="this.src='https://via.placeholder.com/50'" style="width:50px; height:50px; border-radius: 50%; border: 2px solid var(--primary);">
                <div>
                    <h6 class="fw-bold mb-0">MANOJ NEHRA</h6>
                    <div id="welcome-user" class="small text-info fw-bold">Welcome, Student</div>
                </div>
            </div>
        </header>

        <div class="container mt-3">
            <!-- Home Page -->
            <div id="homePage" class="page active">
                <div class="py-3"><h3 class="fw-800">Premium Study Notes</h3></div>
                <div id="notesGrid" class="row g-3"></div>
            </div>

            <!-- Tests Page -->
            <div id="testSeriesPage" class="page">
                <div class="py-3 text-center"><h3 class="fw-800">Online Mock Tests</h3></div>
                <div id="testSeriesGrid" class="row g-3"></div>
            </div>

            <!-- Library Page -->
            <div id="purchasePage" class="page">
                <h3 class="text-center py-4">My Library</h3>
                <div id="myNotesGrid" class="mb-4"></div>
                <div id="myTestsGrid"></div>
            </div>

            <!-- 3D Profile Page -->
            <div id="profilePage" class="page">
                <div class="profile-3d-wrap mt-4">
                    <div class="profile-inner text-center">
                        <img id="u-img" src="" class="rounded-circle mb-4 shadow-lg" style="width: 110px; height:110px; border: 4px solid var(--primary); object-fit:cover;">
                        
                        <div class="input-group-3d"><input id="prof-name" type="text" placeholder="Full Name"></div>
                        <div class="input-group-3d"><input id="prof-phone" type="number" placeholder="Mobile Number"></div>
                        <div class="input-group-3d"><input id="prof-state" type="text" placeholder="Your State (e.g. Rajasthan)"></div>
                        
                        <button onclick="updateProfile()" class="btn btn-primary w-100 rounded-pill py-3 mt-2 fw-bold shadow">Save Profile Changes</button>

                        <div class="mt-5 text-start">
                            <button onclick="showInfoPage('about')" class="btn-3d-tile"><i class="fa fa-university"></i> About Manoj Nehra</button>
                            <button onclick="showInfoPage('contact')" class="btn-3d-tile"><i class="fa fa-envelope"></i> Help & Support</button>
                            <button onclick="showInfoPage('privacy')" class="btn-3d-tile"><i class="fa fa-shield-halved"></i> Privacy & Policy</button>
                        </div>

                        <button onclick="logout()" class="btn btn-danger w-100 py-3 mt-4 rounded-pill fw-bold">Logout Securely</button>
                    </div>
                </div>
            </div>
        </div>

        <nav class="nav-dock">
            <div class="nav-link-3d active" onclick="showPage('homePage', this)"><i class="fas fa-home"></i>Home</div>
            <div class="nav-link-3d" onclick="showPage('testSeriesPage', this)"><i class="fas fa-edit"></i>Tests</div>
            <div class="nav-link-3d" onclick="showPage('purchasePage', this)"><i class="fas fa-bookmark"></i>Library</div>
            <div class="nav-link-3d" onclick="showPage('profilePage', this)"><i class="fas fa-user-gear"></i>Profile</div>
        </nav>
    </div>

    <!-- INFO PAGES MODAL -->
    <div id="info-page-overlay">
        <div class="info-header d-flex justify-content-between align-items-center">
            <h4 id="info-title" class="fw-bold mb-0 text-primary">Policy Page</h4>
            <button onclick="closeInfoPage()" class="btn btn-outline-danger btn-sm rounded-pill px-3">Close X</button>
        </div>
        <div class="info-body" id="info-content"></div>
    </div>

    <!-- Placeholders for other overlays -->
    <div id="testListOverlay"></div>
    <div id="exam-overlay"></div>
    <div id="result-overlay"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, get, update, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- FIREBASE CONFIGURATION ---
        // IMPORTANT: Replace this with your actual Firebase project config if the below is incorrect
        const firebaseConfig = { 
            apiKey: "AIzaSyAhg7hKJ123JRAfio7fymK543XpuNonMHo", 
            databaseURL: "https://showpdf-ffa34-default-rtdb.firebaseio.com", 
            projectId: "showpdf-ffa34",
            authDomain: "showpdf-ffa34.firebaseapp.com" // Added for better auth handling
        };

        let app, auth, db, provider;

        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getDatabase(app);
            provider = new GoogleAuthProvider();
            // Force account selection to avoid stuck login loops
            provider.setCustomParameters({
                prompt: 'select_account'
            });
        } catch (e) {
            console.error("Firebase Init Error:", e);
        }

        // --- AUTHENTICATION LOGIC (FIXED) ---
        window.login = async () => {
            try {
                if (!auth) throw new Error("Firebase not initialized");
                
                // Using signInWithPopup (works best on desktop/modern mobile browsers)
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                
                // Optional: Save basic user data immediately
                const userRef = ref(db, 'users/' + user.uid);
                const snapshot = await get(userRef);
                if (!snapshot.exists()) {
                    await set(userRef, {
                        email: user.email,
                        name: user.displayName,
                        createdAt: new Date().toISOString()
                    });
                }
                
                Swal.fire({
                    icon: 'success',
                    title: 'Login Successful',
                    text: `Welcome, ${user.displayName}!`,
                    timer: 1500,
                    showConfirmButton: false
                });

            } catch (error) {
                console.error("Login Error:", error);
                
                let errorMsg = "Login failed. Please try again.";
                if(error.code === 'auth/popup-closed-by-user') errorMsg = "You closed the login popup.";
                if(error.code === 'auth/unauthorized-domain') errorMsg = "Domain not authorized in Firebase Console.";
                if(error.code === 'auth/operation-not-allowed') errorMsg = "Google Sign-In is not enabled in Firebase.";

                Swal.fire({
                    title: 'Login Error',
                    text: errorMsg + `\n(${error.message})`,
                    icon: 'error'
                });
            }
        };

        window.logout = () => {
            signOut(auth).then(() => {
                location.reload();
            }).catch((error) => {
                console.error("Logout Error:", error);
            });
        };

        // --- AUTH STATE LISTENER ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                document.getElementById('welcome-user').innerText = "Welcome, " + (user.displayName || "User");
                document.getElementById('u-img').src = user.photoURL || "https://via.placeholder.com/110";

                // Load Profile Data
                try {
                    const pSnap = await get(ref(db, `users/${user.uid}/profile`));
                    if (pSnap.exists()) {
                        const d = pSnap.val();
                        document.getElementById('prof-name').value = d.name || "";
                        document.getElementById('prof-phone').value = d.phone || "";
                        document.getElementById('prof-state').value = d.state || "";
                    } else {
                        document.getElementById('prof-name').value = user.displayName || "";
                    }
                } catch(e) { console.log("Profile fetch error", e); }

                // Placeholder calls for functions not fully provided in snippet
                if(typeof loadNotes === 'function') loadNotes();
                if(typeof loadTestSeries === 'function') loadTestSeries();

            } else {
                document.getElementById('auth-screen').style.display = 'flex';
                document.getElementById('main-app').style.display = 'none';
            }
        });

        // --- PROFILE UPDATE LOGIC ---
        window.updateProfile = async () => {
            const user = auth.currentUser;
            if(!user) return;

            const data = { 
                name: document.getElementById('prof-name').value, 
                phone: document.getElementById('prof-phone').value, 
                state: document.getElementById('prof-state').value,
                photo: user.photoURL,
                updatedAt: new Date().toISOString()
            };

            try {
                await update(ref(db, `users/${user.uid}/profile`), data);
                Swal.fire('Success', 'Profile saved successfully!', 'success');
            } catch(err) {
                Swal.fire('Error', 'Could not save profile: ' + err.message, 'error');
            }
        };

        // --- NAVIGATION & UI LOGIC ---
        window.showPage = (id, el) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            document.querySelectorAll('.nav-link-3d').forEach(n => n.classList.remove('active'));
            if(el) el.classList.add('active');
        };

        // --- CONTENT DATA (Static for Info Pages) ---
        const pageData = {
            about: `<h2>About Manoj Nehra Official Hub</h2>
                    <p>Manoj Nehra Official Hub is Rajasthan's fastest-growing digital learning platform...</p>`,
            
            privacy: `<h2>Privacy Policy</h2><p>Secure authentication via Google Firebase...</p>`,
            
            contact: `<h2>Contact Us</h2><p>Email: support@manojnehra.com</p>`
        };

        window.showInfoPage = (type) => {
            document.getElementById('info-page-overlay').style.display = 'flex';
            document.getElementById('info-title').innerText = type.toUpperCase();
            document.getElementById('info-content').innerHTML = pageData[type] || "Content loading...";
        };
        window.closeInfoPage = () => document.getElementById('info-page-overlay').style.display = 'none';

    </script>
</body>
</html>
